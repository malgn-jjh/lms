<style>
.font11 { font-size:11px; letter-spacing:-1px; }
</style>

<script language="javascript" type="text/javascript" src="/common/js/grid.prototype.js"></script>
<div class="tabs" style="float:left;height:23px;margin-bottom:5px;position:relative;">
	<div style="position:absolute;width:100%;height:1px;top:22px;border-top:1px solid #91A7B4;"><!----></div>
	<div style="position:absolute;">
		<ul style="float:left;">
			<li><span><a href="course_modify.jsp?id={{cid}}">과정정보</a></span></li>
			<li class='current'><span>차시관리</span></li>
			<li><span><a href="course_evaluation.jsp?cid={{cid}}">평가관리</a></span></li>
		</ul>
	</div>
</div>
<div style="clear:both;"></div>


<table class="c_tb01" cellpadding="0" cellspacing="0">
<tr>
	<td class="c_th01">과정 정보</td>
	<td class="c_td01"></td>
</tr>
</table>

<table class="f_tb01" cellpadding="0" cellspacing="0" style="table-layout:fixed;">
<col width="120"><col>
<tr>
	<td class="f_th01">카테고리</td>
	<td class="f_td01">{{course.cate_name}}</td>
</tr>
<tr>
	<td class="f_th01">과정명</td>
	<td class="f_td01">
		[ {{course.year}} 년도 / {{course.step}} 기 ] <strong>{{course.course_nm}}</strong>
	</td>
</tr>
<tr>
	<td class="f_th01">상태</td>
	<td class="f_td01">{{course.status_conv}}</td>
</tr>
</table>

<table class="a_tb01" cellpadding="0" cellspacing="0" border="0">
<tr>
	<td class="a_th01">Total : <span id="lesson_cnt" style="color:blue;">{{lesson_cnt}}</span> 차시</td>
	<td class="a_td01" style="font-weight:normal;">
		<!--@if(course.period_yn)-->
		<span style="color:#4C5BA9">학습기간 일괄설정 : </span>
		<span class="font11">
		<input type="text" name="tmp_cnt1" size="3" id="tmp_cnt1" style="text-align:center">차시 단위로 
		<input type="text" name="tmp_cnt2" size="3" id="tmp_cnt2" style="text-align:center">일 간견으로 &nbsp;
		<input type="button" value="설정" class="btn_simp" onclick="autoPeriod();"> 
		<span class="desc01"> 이전 등록된 기간은 삭제됩니다. </span> &nbsp;
		</span>
		<!--/if(course.period_yn)-->
		<input type="button" value="차시추가" class="btn_simp" onclick="addLesson();" />
		<input type="button" value="선택삭제" class="btn_simp" onclick="delLesson()" />
	</td>
</tr>
</table>

<form method="POST" name="form1" target="sysfrm">
<input type="hidden" name="smode" value="">
<input type="hidden" name="a_chapter_cnt" value="">
<input type="hidden" name="a_day_cnt" value="">

<table id="grid" class="l_tb01" cellpadding="0" cellspacing="0" style="margin-top:0px">
<colgroup>
<col width="60">
<col width="80">
<col>
<!--@if(course.period_yn)--><col width="180"><!--/if(course.period_yn)-->
<col width="110">
<col width="70">
<col width="40">
</colgroup>
<thead>
<tr>
	<td class="l_th03">차시</td>
	<td class="l_th03">콘텐츠타입</td>
	<td class="l_th03">차시명</td>
	<!--@if(course.period_yn)-->
	<td class="l_th03">학습기간(개강일 기준)</td>
	<!--/if(course.period_yn)-->
	<td class="l_th03">미리보기</td>
	<td class="l_th03">순서</td>
	<td class="l_th03"><input type="checkbox" onclick="AutoCheck('form1', 'lesson_idx');" id="check_all"/></td>
</tr>
</thead>
<tbody>
<!--@loop(list)-->
<tr align="center">
	<td class="l_td01">
		<select name="chapter" onchange="moveRow(grid.findRow(this), this.value);">
		</select>
	</td>
	<td class="l_td01">
		{{list.lesson_type_conv}}
		<!--@nif(course.period_yn)-->
		<input type="hidden" name="start_day" value="{{list.start_day}}">
		<input type="hidden" name="period" value="{{list.period}}">
		<!--/nif(course.period_yn)-->
	</td>
	<td class="l_td01">
		<a href ="javaScript:OpenWindow('../course/lesson_modify.jsp?cid={{cid}}&id={{list.id}}', 'CL77', 800, 500);">{{list.lesson_nm}}</a>
	</td>
	<!--@if(course.period_yn)-->
	<td class="l_td01" class="font11">
		<input type="text" name="start_day" value="{{list.start_day}}" size="3" style="text-align:center;">일 후 부터
		<input type="text" name="period" value="{{list.period}}" size="3" style="text-align:center;">일 동안
	</td>
	<!--/if(course.period_yn)-->
	<td class="l_td01">
		<input type="button" value="Web" class="btn_simp" onclick="OpenWindow('../content/preview_lesson.jsp?id={{list.lesson_id}}', 'pre01', {{list.content_width}}, {{list.content_height}})">
		<!--@if(list.moblie_block)-->
		<input type="button" class="btn_simp" value="Mobile" onclick="OpenWindow('../content/preview_mobile.jsp?id={{list.lesson_id}}', 'pre02', {{list.content_width}}, {{list.content_height}})">
		<!--/if(list.moblie_block)-->
	</td>
	<td class="l_td01">
		<span onclick="grid.up(this);" class="mvarrow">▲</span>
		<span onclick="grid.down(this);" class="mvarrow">▼</span>
	</td>
	<td class="l_td01">
		<input type="hidden" name="content_id"  value="{{list.id}}">
		<input type="hidden" name="lesson_id"  value="{{list.lesson_id}}">
		<input type="checkbox" name="lesson_idx"  value="{{list.id}}">
	</td>
</tr>
<!--/loop(list)-->
</tbody>
</table>

<!--@nif(list)-->
<table class="n_tb01" cellpadding="0" cellspacing="0">
<tr>
	<td>등록된 차시가 없습니다.</td>
</tr>
</table>
<!--/nif(list)-->

<table class="b_tb01" cellpadding="0" cellspacing="0">
<tr>
	<td class="b_th01">
	</td>
	<td class="b_td01">
		<button type="submit" class="bttn2">저장</button>
	</td>
</tr>
</table>
</form>
{{form_script}}

<script>

var grid = new MGRID("grid");
grid.rowActiveColor = "#F4FAFF";
var lessonWindow;


function getIdx() {
	var arr = new Array();
	$("#grid input[name='lesson_id']").each(function() {
		arr.push($(this).val());
	});
	return arr.join(",");
}

//추가
function addLesson() {
	OpenWindows("lesson_select.jsp?cid={{cid}}&idx=" + getIdx(), "_CLS01", 800, 600);
}

//장
function setChapter() {
/*
	var sorts = document.getElementsByName("chapter");
	var optStr = "";
	for(var i=0; i<sorts.length; i++) { sorts[i].innerHTML = ""; optStr += "<option value='" + (i+1) + "'>" + (i+1) + "</option>"; }
	for(var i=0; i<sorts.length; i++) {	sorts[i].innerHTML = optStr; sorts[i].value = i+1; }
*/


	var sorts = document.getElementsByName("chapter");
	for(var i=0; i<sorts.length; i++) {
		var ms = sorts[i].length;
		for(var j=ms - 1; j>=0; j--) removeSelectOption(sorts[i], j);
//		for(var j=0; j<sorts.length; j++) addSelectOption(sorts[i], j+1, j+1);
		for(var j=0; j<sorts.length; j++) sorts[i].options.add(new Option(j+1, j+1));
		if(navigator.userAgent.indexOf("compatible; MSIE 6") != -1) document.body.innerHTML += "";
		sorts[i].value = i+1;
//		sorts[i].options[i].selected = true;
	}

}

function moveRow(row, v) {
	if(row.rowIndex == v) {	setChapter(); return; }
	swapRow(row, v);
}

function swapRow(row, v) {
	v = parseInt(v);
	var fromElement = row.rowIndex < v ? row.nextSibling : row.previousSibling;
	try {
		var clone = row.cloneNode(true);
		var parent = row.parentNode;
		fromElement = parent.replaceChild(clone, fromElement);
		parent.replaceChild(fromElement, row);
		parent.replaceChild(row, clone);
		clone = null;
	} catch(e) { }

	moveRow(row, v);
}

//차시수
function setItemCnt() {
	document.getElementById("lesson_cnt").innerHTML = grid.getLength();
}

<!--@loop(listxx)-->
grid.addRow(null, new Array(
	'<select name="chapter" onchange="moveRow(grid.findRow(this), this.value);"></select>'
	, '{{list.lesson_type_conv}}<!--@nif(course.period_yn)--><input type="hidden" name="start_day" value="{{list.start_day}}"><input type="hidden" value="{{list.period}}" name="period"><!--/nif(course.period_yn)-->'
	, '<a href ="javaScript:OpenWindow(\'../course/lesson_modify.jsp?cid={{cid}}&id={{list.id}}\', \'CL77\', 800, 500);">{{list.lesson_nm}}</a>'
	<!--@if(course.period_yn)-->
	, '<input type="text" size="3" value="{{list.start_day}}" name="start_day"> 일 후 부터 <input type="text" size="3" value="{{list.period}}" name="period"> 일 동안'
	<!--/if(course.period_yn)-->
	, '<input type="button" value="Web" class="btn_simp" onclick="OpenWindow(\'../content/preview_lesson.jsp?id={{list.lesson_id}}\', \'pre01\', {{list.content_width}}, {{list.content_height}})"><!--@if(list.moblie_block)--> <input type="button" class="btn_simp" value="Mobile" onclick="OpenWindow(\'../content/preview_mobile.jsp?id={{list.lesson_id}}\', \'pre02\', {{list.content_width}}, {{list.content_height}})"><!--/if(list.moblie_block)-->'
	, '<span onclick="grid.up(this);" class="mvarrow">▲</span> <span onclick="grid.down(this);" class="mvarrow">▼</span>'
	, '<input type="hidden" name="content_id"  value="{{list.id}}"><input type="hidden" name="lesson_id"  value="{{list.lesson_id}}"><input type="checkbox" name="lesson_idx"  value="{{list.id}}">')
);
<!--/loop(listxx)-->

grid.callbackInsert = grid.callbackDelete = grid.callbackSwap = "setChapter";
grid.setActiveColor(-1);

function init() {
	setChapter();
	setItemCnt();
}

//삭제
function delLesson() {
	var elements = document.getElementsByName("lesson_idx");
	var arr = new Array();
	for(var i=0; i<elements.length; i++) {
		if(elements[i].checked) { arr.push(elements[i].value); }
	}
	if(arr.length == 0) { alert("선택된 차시가 없습니다."); return; }
	if(!confirm("삭제하시겠습니까?")) return;

	location.href = "course_lesson.jsp?mode=del&idx=" + arr.join(",") + "&{{query}}";

}

//자동기간 설정
function autoPeriod() {
	var f = document.forms['form1'];
	var cnt1 = document.getElementById("tmp_cnt1").value;
	var cnt2 = document.getElementById("tmp_cnt2").value;

	if(cnt1 * 1 <= 0) { alert("단위는 1차시 이상이어야 합니다."); return; }
	if(cnt2 * 1 <= 0) { alert("간격은 1일 이상이어야 합니다."); return false; }

	if(!validate(f)) { return; }
	if(!confirm("학습기간을 설정 하시겠습니까?")) { return; }
	f['a_chapter_cnt'].value = cnt1; f['a_day_cnt'].value = cnt2; f['smode'].value = "period";
	f.submit();
}

addEvent("load", init);

</script>