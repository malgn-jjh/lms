<style type="text/css">
.l_td01 {text-overflow:ellipsis; white-space:nowrap; overflow:hidden;}
</style>

<!--@if(management_block)-->
<script> var onTab = 'user'; </script>
<!--@include(/management/tab.html)-->
<!--/if(management_block)-->

<form name="form1" method="get">
<input type="hidden" name="cid" value="{{cid}}">
<!--@if(management_block)--><input type="hidden" name="s_course_id" value=""><!--/if(management_block)-->
<input type="hidden" name="ord" value="">
<input type="hidden" name="mode" value="{{mode}}">

<table class="t_tb01" cellpadding="0" cellspacing="0" style="table-layout:fixed;">
<col width="110"><col>
<col width="110"><col>
<col width="110"><col>
<!--@nif(management_block)-->
<tr>
	<td class="t_th01">과정카테고리</td>
	<td class="t_td01" colspan="3">
		<select name="s_category" class="js-example-basic-single">
		<option value=""> - 전체 - </option>
		<!--@loop(categories)-->
		<option value="{{categories.id}}"> {{categories.name_conv}} </option>
		<!--/loop(categories)-->
		</select>
	</td>
	<td class="t_th01">기간구분</td>
	<td class="t_td01">
		<label><input type="radio" value="" name="s_type" class="ipt01" checked="checked"> 전체 </label> &nbsp;
		<!--@loop(types)-->
		<label><input type="radio" value="{{types.id}}" name="s_type" class="ipt01"> {{types.name}} </label> &nbsp;
		<!--/loop(types)-->
	</td>
</tr>
<tr>
	<td class="t_th01">과정명</td>
	<td class="t_td01" colspan="3">
		<select name="s_course_id" class="js-example-basic-single">
		<option value=""> - 전체 - </option>
		<!--@loop(courses)-->
		<option value="{{courses.id}}"> {{courses.course_nm}} </option>
		<!--/loop(courses)-->
		</select>
	</td>
	<td class="t_th01">과정구분</td>
	<td class="t_td01">
		<label><input type="radio" name="s_onofftype" value="" class="ipt01" checked="checked"> 전체 </label> &nbsp;
		<!--@loop(onoff_types)-->
		<label><input type="radio" name="s_onofftype" value="{{onoff_types.id}}" class="ipt01"> {{onoff_types.name}} </label> &nbsp;
		<!--/loop(onoff_types)-->
	</td>
</tr>
<!--/nif(management_block)-->
<tr>
	<td class="t_th01">회원소속</td>
	<td class="t_td01" colspan="3">
		<select name="s_dept" class="js-example-basic-single">
		<option value=""> - 전체 - </option>
		<!--@loop(dept_list)-->
		<option value="{{dept_list.id}}">{{dept_list.name_conv}}</option>
		<!--/loop(dept_list)-->
		</select>
	</td>
	<td class="t_th01">수료여부</td>
	<td class="t_td01">
		<label><input type="radio" name="s_complete" value="" class="ipt01" checked="checked"> 전체 </label>  &nbsp;
		<label><input type="radio" name="s_complete" value="Y" class="ipt01"> 수료 </label>  &nbsp;
		<label><input type="radio" name="s_complete" value="N" class="ipt01"> 미수료 </label>
	</td>
</tr>
<tr>
	<td class="t_th01">등록일</td>
	<td class="t_td01">
		<input type="text" name="s_reg_sdate" class="cal01" /> ~
		<input type="text" name="s_reg_edate" class="cal01" />
	</td>
	<td class="t_th01">학습기간</td>
	<td class="t_td01">
		<input type="text" name="s_start_date" class="cal01" /> ~
		<input type="text" name="s_end_date" class="cal01" />
		<button type="button" class="btn_simp" onclick="setTodayStudyDate();">오늘</button>
	</td>
	<td class="t_th01">수료처리일자</td>
	<td class="t_td01">
		<input type="text" name="s_complete_sdate" class="cal01" /> ~
		<input type="text" name="s_complete_edate" class="cal01" />
	</td>
</tr>
<tr>
	<td class="t_th01">수강생상태</td>
	<td class="t_td01" colspan="3">
		<label><input type="radio" name="s_status" value="" class="ipt01" checked="checked"> 전체 </label> &nbsp;
		<!--@loop(status_list)-->
		<label><input type="radio" name="s_status" value="{{status_list.id}}" class="ipt01"> {{status_list.name}} </label> &nbsp;
		<!--/loop(status_list)-->
	</td>
	<td class="t_th01">회원상태</td>
	<td class="t_td01">
		<label><input type="radio" name="s_out_yn" value="" class="ipt01" checked="checked"> 삭제회원제외 </label> &nbsp;
		<label><input type="radio" name="s_out_yn" value="Y" class="ipt01"> 삭제회원포함 </label> &nbsp;
	</td>
</tr>
<tr>
	<td class="t_th01">검색</td>
	<td class="t_td01" colspan="5">
		<select name="s_field" onchange="document.forms['form1']['s_keyword'].focus();">
			<option value=""> - 전체 - </option>
			<option value="a.id">수강생번호</option>
			<option value="a.order_id">주문번호</option>
			<option value="a.order_item_id">주문항목번호</option>
			<option value="a.user_id">회원번호</option>
			<option value="u.user_nm">회원명</option>
			<option value="u.login_id">회원아이디</option>
			<option value="u.etc1">{{SITE_CONFIG.user_etc_nm1}}</option>
			<option value="u.etc2">{{SITE_CONFIG.user_etc_nm2}}</option>
			<option value="u.etc3">{{SITE_CONFIG.user_etc_nm3}}</option>
			<option value="u.etc4">{{SITE_CONFIG.user_etc_nm4}}</option>
			<option value="u.etc5">{{SITE_CONFIG.user_etc_nm5}}</option>
		</select>
		<input type="text" name="s_keyword" size="30" onfocus="this.select();">
		<button type="submit" class="bttn2">검색</button>
	</td>
</tr>
</table>

<div style="float:left;">
<table class="a_tb01" cellpadding="0" cellspacing="0" border="0">
<tr>
	<td class="a_th01">
		{{list_total}} &nbsp;
		<select name="s_listnum" onchange="document.forms['form1'].submit();">
			<option value="20">20</option>
			<option value="50">50</option>
			<option value="100">100</option>
		</select> 건씩 보기
	</td>
	<td class="a_td01"></td>
</tr>
</table>
</div>
</form>
{{form_script}}

<div style="float:right;">
<form name="form2" method="post">
<table class="a_tb01" cellpadding="0" cellspacing="0" border="0">
<tr>
	<td class="a_th01"></td>
	<td class="a_td01">
		<!--@if(s_course_id)-->
		<button type="button" class="bttn2 sky" onclick="OpenWindows('user_add.jsp?cid={{s_course_id}}', '_CUA1', 900, 700);">수강생등록</button>
		<button type="button" class="bttn2 sky" onclick="location.href='user_excel.jsp?cid={{s_course_id}}&{{query}}';">일괄등록</button>
		<!--@if(alltime_block)-->
			<button type="button" class="bttn2 green" onclick="modifyStudyDate();">학습기간일괄수정</button>
		<!--/if(alltime_block)-->
		<!--/if(s_course_id)-->
		<button type="button" class="bttn2" onclick="sendMailAllUser();">전체메일</button>
		<button type="button" class="bttn2" onclick="sendMailUser();">메일</button>
		<button type="button" class="bttn2" onclick="sendSmsUser();">SMS</button>
		<button type="button" class="bttn2" onclick="sendMsgUser();">쪽지</button>
		<button type="button" class="bttn2" onclick="document.forms['form1']['mode'].value='excel';document.forms['form1'].submit();document.forms['form1']['mode'].value='';">EXCEL</button>
		&nbsp;&nbsp;
		선택한 항목을
		<select name="a_status" onchange="setOption(this);">
		<!--@loop(status_list)-->
		<option value="{{status_list.id}}">{{status_list.name}}</option>
		<!--/loop(status_list)-->
		<!--@if(management_block)-->
		<option value="-1">삭제</option>
		<!--/if(management_block)-->
		</select>
		으로
		<button type="button" class="bttn2" onclick="goChange()">변경</button>
	</td>
</tr>
</table>
</div>

<script>
function goChange() {
	var elements = document.getElementsByName("idx");
	var arr = new Array();
	for(var i=0; i<elements.length; i++) {
		if(elements[i].checked) arr.push(elements[i]);
	}
	if(arr.length == 0) { alert("선택 항목이 없습니다"); return; }

	if(!confirm("변경하시겠습니까?")) { return; }
	document.forms['form2'].submit();
}
function setOption(el) {
	if(el.value != -1) return;
	var tgt = (confirm("삭제상태로 변경하면 수강생 목록에서도 나타나지 않고\n삭제되어 복구가 불가능합니다.\n\n수강취소 상태로만 변경해도 수강이 불가능하고\n착오가 있었을 경우 정상으로 복구할 수 있습니다.\n\n수강취소 상태를 선택하시겠습니까?") ? "-4" : "-1")
	for(var i = 0; i < el.length; i++) {
		if(el.options[i].value == tgt) el.options[i].selected = true;
	}
}
</script>

<table class="l_tb01" cellpadding="0" cellspacing="0" style="table-layout:fixed">
<colgroup>
	<col width="75">
	<col>
	<!--@nif(management_block)-->
	<col width="60">
	<col>
	<!--/nif(management_block)-->
	<col width="70">
	<col width="140">
	<!--@if(admin_block)--><col width="80"><!--/if(admin_block)-->
	<col width="70">
	<col width="60">
	<col width="70">
	<col width="40">
</colgroup>
<thead>
<tr align="center">
	<td class="l_th01"><span class="l_sort01" id="CL_a.id" onclick="ListSort(this, '{{ord}}')">수강생ID</span></td>
	<td class="l_th01"><span class="l_sort01" id="CL_u.user_nm" onclick="ListSort(this, '{{ord}}')">수강생</span></td>
	<!--@nif(management_block)-->
	<td class="l_th01"><span class="l_sort01" id="CL_c.onoff_type" onclick="ListSort(this, '{{ord}}')">과정구분</span></td>
	<td class="l_th01"><span class="l_sort01" id="CL_c.course_nm" onclick="ListSort(this, '{{ord}}')">과정명</span></td>
	<!--/nif(management_block)-->
	<td class="l_th01"><span class="l_sort01" id="CL_a.progress_ratio" onclick="ListSort(this, '{{ord}}')">진도율</span></td>
	<td class="l_th01"><span class="l_sort01" id="CL_a.start_date" onclick="ListSort(this, '{{ord}}')">학습기간</span></td>
	<!--@if(admin_block)--><td class="l_th01">결제금액</td><!--/if(admin_block)-->
	<td class="l_th01"><span class="l_sort01" id="CL_a.reg_date" onclick="ListSort(this, '{{ord}}')">등록일</span></td>
	<td class="l_th01"><span class="l_sort01" id="CL_a.complete_yn" onclick="ListSort(this, '{{ord}}')">수료</span></td>
	<td class="l_th01"><span class="l_sort01" id="CL_a.status" onclick="ListSort(this, '{{ord}}')">상태</span></td>
	<td class="l_th01"><input type="checkbox" onclick="AutoCheck('form2', 'idx')"></td>
</tr>
</thead>
<tbody>
<!--@loop(list)-->
<tr class="l_tr_{{list.ROW_CLASS}}" align="center">
	<td class="l_td01">{{list.id}}</td>
	<td class="l_td01" align="left" title="{{list.user_nm}} ({{list.login_id}})"><span class="crm" _id="{{list.user_id}}">{{list.user_nm}} ({{list.login_id}})</span></td>
	<!--@nif(management_block)-->
	<td class="l_td01"><span class="label">{{list.onoff_type_conv}}</span></td>
	<td class="l_td01" style="line-height:22px;" align="left" title="{{list.course_nm}}">
		<!--@if(list.package_block)-->[패키지] <!--/if(list.package_block)-->{{list.course_nm}}
	</td>
	<!--/nif(management_block)-->
	<td class="l_td01" align="right" title="진도로그조회">
		<a href="javascript:OpenLayer('../crm/log_list.jsp?ch=poplayer&uid={{list.user_id}}&s_course_user_id={{list.id}}', '_LESSONLOG', 1000, 900);">{{list.progress_ratio_conv}}%</a>
	</td>
	<td class="l_td01" title="수강정보조회">
		<a href="javascript:OpenLayer('../crm/course_view.jsp?ch=poplayer&cuid={{list.id}}&uid={{list.user_id}}', '_CUINFO', 1000, 900);">{{list.start_date_conv}} ~ {{list.end_date_conv}}</a>
	</td>
	<!--@if(admin_block)-->
	<td class="l_td01" align="right" title="주문정보조회">
		<!--@if(list.order_block)-->
		<a href="javascript:OpenLayer('../order/order_view.jsp?ch=poplayer&id={{list.order_id}}', '_ORDERINFO', 1000, 900);">{{list.pay_price_conv}}원</a>
		<!--/if(list.order_block)-->
		<!--@nif(list.order_block)-->-<!--/nif(list.order_block)-->
	</td>
	<!--/if(admin_block)-->
	<td class="l_td01">{{list.reg_date_conv}}</td>
	<td class="l_td01">
		<!--@if(list.complete_yn)-->
		<!--@if(list.cert_complete_yn)-->
			<!--@if(template_block)-->
			<input type="button" class="btn_simp" value="수료증" onclick="OpenWindow('../complete/certificate_template.jsp?cuid={{list.id}}', '_CC01', '650', '950')">
			<!--/if(template_block)-->
			<!--@nif(template_block)-->
			<input type="button" class="btn_simp" value="수료증" onclick="OpenWindow('../complete/certificate.jsp?cuid={{list.id}}', '_CC01', '650', '950')">
			<!--/nif(template_block)-->
		<!--/if(list.cert_complete_yn)-->
		<!--@nif(list.cert_complete_yn)-->수료<!--/nif(list.cert_complete_yn)-->
		<!--/if(list.complete_yn)-->
		<!--@nif(list.complete_yn)-->{{list.complete_yn_conv}}<!--/nif(list.complete_yn)-->
	</td>
	<td class="l_td01">
		<!--@if(list.deposit_block)-->
			<!--@if(admin_block)--><input type="button" class="btn_simp red" value="입금확인" onclick="depositOrder('{{list.order_id}}', '{{list.pay_price_conv}}')"><!--/if(admin_block)-->
			<!--@nif(admin_block)-->{{list.status_conv}}<!--/nif(admin_block)-->
		<!--/if(list.deposit_block)-->
		<!--@if(list.confirm_block)-->
		<input type="button" class="btn_simp blue" value="수강승인" onclick="setConfirm('{{list.id}}')">
		<!--/if(list.confirm_block)-->
		<!--@nif(list.important_block)-->{{list.status_conv}}<!--/nif(list.important_block)-->
	</td>
	<td class="l_td01"><input type="checkbox" name="idx" value="{{list.id}}" userid="{{list.user_id}}"></td>
</tr>
<!--/loop(list)-->
</tbody>
</table>
<!--@nif(list)-->
<table class="n_tb01" cellpadding="0" cellspacing="0">
<tr>
	<td>해당 자료가 없습니다.</td>
</tr>
</table>
<!--/nif(list)-->

<table class="p_tb01" cellpadding="0" cellspacing="0">
<tr>
	<td class="p_td01">{{pagebar}}</td>
</tr>
</table>

<script>ListSort(null, "{{ord}}");</script>
</form>

<script>
function setTodayStudyDate() {
	var f = document.forms['form1'];
	var d = new Date();
	var today = d.getFullYear() + "-" + (d.getMonth() < 9 ? "0" : "") + (d.getMonth() + 1) + "-" + (d.getDate() < 10 ? "0" : "") + d.getDate();
	f['s_start_date'].value = today;
	f['s_end_date'].value = today;
}

function setConfirm(cuid) {
	if(!confirm("선택한 수강생의 수강을 승인하시겠습니까?")) return;	
	sysfrm.location.href = "user_list.jsp?mode=confirm&cuid=" + cuid + "&{{list_query}}";
}
function depositOrder(oid, price) {
	if(!confirm(price + "원의 입금을 확인하시겠습니까?\n주문에 포함된 모든 항목을 입금확인처리합니다.")) return;	
	sysfrm.location.href = "user_list.jsp?mode=deposit&oid=" + oid + "&{{list_query}}";
}
function sendMsgUser() {
	var idx = setUserValue();
	if(idx =="") alert("선택한 회원이 없습니다.");
	else if(confirm("쪽지를 발송하시겠습니까?")) OpenPopSendMsg(idx);
}

function sendMailAllUser() {
	var idx = call("user_list.jsp?mode=uidx&{{mode_query}}");
	if(idx == "") alert("검색된 회원이 없습니다.");
	else if(confirm("메일을 발송하시겠습니까?")) OpenPopSendMail(idx);
}

function sendMailUser() {
	var idx = setUserValue();
	if(idx == "") alert("선택한 회원이 없습니다.");
	else if(confirm("메일을 발송하시겠습니까?")) OpenPopSendMail(idx);
}

function sendSmsUser() {
	var idx = setUserValue();
	if(idx == "") alert("선택한 회원이 없습니다.");
	else if(confirm("SMS를 발송하시겠습니까?")) OpenPopSendSms(idx);
}

<!--@if(alltime_block)-->
function modifyStudyDate() {
	var idx = setCourseUserValue();
	if(idx == "") {
		if(confirm("모든 수강생의 학습기간을 수정하시겠습니까?")) OpenAdminLayer("pop_sdate_modify.jsp?idx=" + idx + "&cid={{cid}}", "M607", 600, 500);
	} else {
		OpenAdminLayer("pop_sdate_modify.jsp?idx=" + idx + "&cid={{cid}}", "M607", 600, 500);
	}
}
<!--/if(alltime_block)-->

function setCourseUserValue() {
	var el = document.getElementsByName('idx');
	if(!el) return "";
	var array = new Array();
	for(var i = 0, max = el.length; i < max; ++i) {
		if(el[i].checked == true) array.push(el[i].value);
	}
	return array.join(",");
}

function setUserValue() {
	var el = document.getElementsByName('idx');
	if(!el) return "";
	var array = new Array();
	for(var i = 0, max = el.length; i < max; ++i) {
		if(el[i].checked == true) array.push(el[i].getAttribute("userid"));
	}
	return array.join(",");
}

function setLabel() {
	var progresses = { "온라인" : "sky", "집합" : "red", "혼합" : "green", "패키지" : "brown" };
	$(".label").each(function() {
		var v = $(this).html();
		$(this).attr("class", "label " + progresses[v]);
	});
}

addEvent("onload", function() { setLabel(); setCRM(); } );
</script>