<script language="javascript" type="text/javascript">initTinyMCE("advanced");</script>
<style>
.pay_price {color:#4C5BA9;}
.disc_price {color:#A94C4C;}
</style>

<form name="form1" method="post" target="sysfrm">
<input type="hidden" name="mode">
<table class="c_tb01" cellpadding="0" cellspacing="0">
<tr>
	<td class="c_th01">
		<!--@nif(modify)--> 등록<!--/nif(modify)-->
		<!--@if(modify)--> 수정<!--/if(modify)--></td>
	<td class="c_td01"></td>
</tr>
</table>

<table class="f_tb01" cellpadding="0" cellspacing="0">
<col width="120"><col>
<tr>
	<td class="f_th01">회원</td>
	<td class="f_td01">{{user_nm}} / <span class="crm" _id="{{user_id}}">{{login_id}}</span></td>
</tr>
<tr>
	<td class="f_th01">전체 주문정보</td>
	<td class="f_td01">
		<table class="f_tb01" cellpadding="0" cellspacing="0" style="margin-bottom:0;table-layout:fixed">
		<col width="120"><col><col width="120"><col>
		<tr>
			<td class="f_th01">주문명</td>
			<td class="f_td01" colspan="3">{{order.order_nm}}</td>
		</tr>
		<tr>
			<td class="f_th01">결제금액</td>
			<td class="f_td01" colspan="3">
				<strong><span style="color:#4C5BA9">실결제금액 {{order.pay_price_conv}}원</span>
				(판매가 {{order.price_conv}}원 +
				<span style="color:#006600">배송비 {{order.delivery_price_conv}}원</span> -
				<span style="color:#A94C4C">쿠폰할인 {{order.coupon_price_conv}}원</span> -
				<span style="color:#a94c4c">회원그룹할인 {{order.disc_group_price_conv}}원</span>)</strong>
			</td>
		</tr>
		<tr>
			<td class="f_th01">결제방법</td>
			<td class="f_td01">{{order.paymethod_conv}}</td>
			<td class="f_th01">실결제일시</td>
			<td class="f_td01">{{order.pay_date_conv}}</td>
		</tr>
		<tr>
			<td class="f_th01">환불액</td>
			<td class="f_td01">{{order.refund_price_conv}}원</td>
			<td class="f_th01">상태</td>
			<td class="f_td01">{{order.status_conv}}</td>
		</tr>
		</table>
	</td>
</tr>
<tr>
	<td class="f_th01">환불 주문정보</td>
	<td class="f_td01">
		<table class="f_tb01" cellpadding="0" cellspacing="0" style="margin-bottom:0;table-layout:fixed">
		<col width="120"><col><col width="120"><col>
		<tr>
			<td class="f_th01">주문항목명</td>
			<td class="f_td01">{{orderitem.product_nm}}</td>
			<td class="f_th01">상품타입</td>
			<td class="f_td01">{{orderitem.product_type_conv}}</td>
		</tr>
		<tr>
			<td class="f_th01">결제금액</td>
			<td class="f_td01" colspan="3">
				<strong><span style="color:#4C5BA9">실결제금액 {{orderitem.pay_price_conv}}원</span>
				(판매가 {{orderitem.price_conv}}원 +
				<span style="color:#006600">배송비 {{orderitem.delivery_price_conv}}원</span> -
				<span style="color:#A94C4C">쿠폰할인 {{orderitem.coupon_price_conv}}원</span> -
				<span style="color:#a94c4c">회원그룹할인 {{orderitem.disc_group_price_conv}}원</span>)</strong>
			</td>
		</tr>
		<tr>
			<td class="f_th01">환불액</td>
			<td class="f_td01">{{orderitem.refund_price_conv}}원</td>
			<td class="f_th01">상태</td>
			<td class="f_td01">{{orderitem.status_conv}}</td>
		</tr>
		</table>
	</td>
</tr>
<!--@if(estimate_block)-->
<tr>
	<td class="f_th01">예상차감 금액</td>
	<td class="f_td01">
		<div class="desc01"> 아래 내용은 환불처리의 편의를 돕기위한 예상수치로 반드시 실제 학습정보를 확인하시기 바랍니다. </div>
		<div class="desc01" style="margin-bottom:4px;"> 환불금액은 지정하신 환불기준에 따라 직접 결정하시기 바랍니다. </div>
		<table class="f_tb01" cellpadding="0" cellspacing="0" style="margin-bottom:0;table-layout:fixed">
		<col width="120"><col>
		<tr>
			<td class="f_th01">수강일 기준</td>
			<td class="f_td01" colspan="3">
				<strong><span class="pay_price">{{orderitem.pay_price_conv}}원</span> X {{cuinfo.day_ratio_conv}}% = <span class="disc_price">{{cuinfo.day_price_conv}}원</span></strong>
				[전체 <span class="pay_price">{{cuinfo.lesson_day_conv}}일</span> 중 <span class="disc_price">{{cuinfo.study_day_conv}}일 ({{cuinfo.day_ratio_conv}}%)</span> 경과]
			</td>
		</tr>
		<tr>
			<td class="f_th01">학습차시 기준</td>
			<td class="f_td01" colspan="3">
				<strong><span class="pay_price">{{orderitem.pay_price_conv}}원</span> X {{cuinfo.cnt_ratio_conv}}% = <span class="disc_price">{{cuinfo.cnt_price_conv}}원</span></strong>
				[전체 <span class="pay_price">{{cuinfo.lesson_cnt_conv}}차시</span> 중 <span class="disc_price">{{cuinfo.study_cnt_conv}}차시 ({{cuinfo.cnt_ratio_conv}}%)</span> 학습]
			</td>
		</tr>
		</table>
	</td>
</tr>
<!--/if(estimate_block)-->
<tr>
	<td class="f_th01">타입</td>
	<td class="f_td01">
		<span id="refundType">{{refund_type_conv}}</span>
		<span class="desc01"> 환불금액에 따라 자동으로 변경됩니다.</span>
	</td>
</tr>
<tr>
	<td class="f_th01">환불금액</td>
	<td class="f_td01">
		<input type="text" name="refund_price" size="10" class="ipt_right" onkeyup="setMax(this, '{{orderitem.pay_price}}')">원 &nbsp;
		[환불가능금액 : {{orderitem.pay_price_conv}}원]
	</td>
</tr>
<tr>
	<td class="f_th01">환불방법</td>
	<td class="f_td01">
		<select name="refund_method" onchange="setMethod(this.value);">
		<!--@loop(refund_methods)-->
		<option value="{{refund_methods.id}}">{{refund_methods.name}}</option>
		<!--/loop(refund_methods)-->
		</select>
		<span id="cancelInfo"><span class="label red">안내</span> 결제취소는 <a href="../order/pg_view.jsp" target="_blank">PG사 상점관리자 페이지</a>에서 직접 해 주셔야 합니다.</span>
	</td>
</tr>
<tr>
	<td class="f_th01">환불정보</td>
	<td class="f_td01">
		<table class="f_tb01" cellpadding="0" cellspacing="0" style="margin-bottom:0;table-layout:fixed" id="refundInfo">
		<col width="120"><col><col width="120"><col>
		<tr>
			<td class="f_th01">요청사항</td>
			<td class="f_td01"><textarea name="req_memo" style="width:99%;height:40px;" class="NoEditor">{{req_memo}}</textarea></td>
		</tr>
		<tr>
			<td class="f_th01">은행명</td>
			<td class="f_td01"><input type="text" name="bank_nm" size="70"></td>
		</tr>
		<tr>
			<td class="f_th01">은행계좌</td>
			<td class="f_td01"><input type="text" name="account_no" size="70"></td>
		</tr>
		<tr>
			<td class="f_th01">예금주</td>
			<td class="f_td01"><input type="text" name="depositor" size="50"></td>
		</tr>
		</table>

	</td>
</tr>
<tr>
	<td class="f_th01">환불일시</td>
	<td class="f_td01">{{refund_date_conv}}</td>
</tr>
<tr>
	<td class="f_th01">관리자메모</td>
	<td class="f_td01"><textarea name="memo" style="width:99%;height:60px;" class="NoEditor">{{memo}}</textarea></td>
</tr>
<tr>
	<td class="f_th01">담당자</td>
	<td class="f_td01">{{manager_nm}}</td>
</tr>
<tr>
	<td class="f_th01">등록일</td>
	<td class="f_td01">{{reg_date_conv}}</td>
</tr>
<tr>
	<td class="f_th01">상태</td>
	<td class="f_td01">
		<select name="status">
		<!--@loop(status_list)-->
		<option value="{{status_list.id}}">{{status_list.name}}</option>
		<!--/loop(status_list)-->
		</select>
		<span class="desc01"> 상태가 변경되었을 시 수강정보와 주문정보가 변경됩니다. </span>
	</td>
</tr>
<tr>
	<td class="f_th01">SMS 발송</td>
	<td class="f_td01">
		<label><input type="checkbox" name="mobile_yn" value="Y" class="ipt01"<!--@nif(SITE_INFO.sms_yn)--> disabled="disabled"<!--/nif(SITE_INFO.sms_yn)-->> 발송</label>
		<span class="desc01">
			{{user_nm}} (<strong>{{mobile_conv}}</strong>) 회원님께 환불처리 SMS를 발송합니다. (단, 완료 또는 환불불가 처리 시 발송됩니다.)
			<!--@nif(SITE_INFO.sms_yn)-->SMS 서비스를 신청하셔야 이용할 수 있습니다.<!--/nif(SITE_INFO.sms_yn)-->
		</span>
	</td>
</tr>
</table>

<table class="b_tb01" cellpadding="0" cellspacing="0">
<tr>
	<td>
		<button type="button" class="bttn2" onclick="location.href='refund_list.jsp?{{list_query}}';">목록</button>
	</td>
	<td class="b_td01">
		<button type="submit" class="bttn2">수정</button>
	</td>
</tr>
</table>

</form>
{{form_script}}

<script language="javascript">
function setMax(el, assign) {
	el.value = el.value.replace(/[^0-9\.]+/gi, '');
	if(el.value * 1 > assign) {
		el.value = assign;
	}
	document.getElementById("refundType").innerHTML = !el.value || el.value == 0 ? "" : (el.value*1 < assign*1 ? "부분환불" : "전액환불");
}
addEvent("load", function() { 
	document.getElementById('refundInfo').style.display = document.forms['form1']['refund_method'].value == '1' ? 'block' : 'none'; 
	setCRM();
	setMethod('{{refund_method}}');
});
function setMethod(v) {
	if(v == "") v = 1;
	document.getElementById('refundInfo').style.display = v == '1' ? 'block' : 'none';
	document.getElementById('cancelInfo').style.display = v == '1' ? 'none' : 'inline';
}
</script>